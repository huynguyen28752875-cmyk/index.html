<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Street Fighters VN: Pro Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; color: white; }
        canvas { display: block; }
        #lobby { position: absolute; inset: 0; background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.9)), url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&q=80&w=2000'); background-size: cover; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .char-card { border: 4px solid #444; padding: 20px; transition: 0.3s; cursor: pointer; background: rgba(255,255,255,0.1); }
        .char-card:hover { border-color: #0cf; transform: scale(1.05); background: rgba(0,204,255,0.2); }
        .selected { border-color: #ff0000 !important; }
        #game-ui { position: absolute; top: 20px; width: 100%; display: none; justify-content: space-around; z-index: 10; }
        .hp-bar { width: 400px; height: 30px; background: #222; border: 2px solid #fff; position: relative; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, #ff4444, #990000); width: 100%; transition: 0.1s; }
        .mana-fill { height: 10px; background: #00f2ff; width: 0%; margin-top: 5px; transition: 0.3s; }
        #fatality { position: absolute; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 200; font-size: 100px; color: red; font-style: italic; }
    </style>
</head>
<body>

    <div id="lobby">
        <h1 class="text-6xl mb-10 italic font-black text-white italic">CHỌN VÕ SĨ</h1>
        <div class="flex gap-10">
            <div class="char-card" onclick="selectChar(1, 'Ninja')">
                <h2 class="text-2xl font-bold">NINJA</h2>
                <p class="text-blue-400 text-sm">Tốc độ: ★★★<br>Sát thương: ★☆☆</p>
            </div>
            <div class="char-card" onclick="selectChar(1, 'Đại Ca')">
                <h2 class="text-2xl font-bold">ĐẠI CA</h2>
                <p class="text-red-400 text-sm">Tốc độ: ★☆☆<br>Sát thương: ★★★</p>
            </div>
            <div class="char-card" onclick="selectChar(1, 'Vovinam')">
                <h2 class="text-2xl font-bold">VOVINAM</h2>
                <p class="text-green-400 text-sm">Tốc độ: ★★☆<br>Mana: ★★★</p>
            </div>
        </div>
        <button onclick="startGame()" class="mt-20 px-10 py-4 bg-red-600 hover:bg-red-700 text-2xl font-bold rounded">QUYẾT CHIẾN!</button>
    </div>

    <div id="game-ui">
        <div>
            <div id="p1-name" class="font-bold italic mb-1 text-red-500">P1</div>
            <div class="hp-bar"><div id="p1-hp" class="hp-fill"></div></div>
            <div id="p1-mana" class="mana-fill"></div>
        </div>
        <div class="text-right">
            <div id="p2-name" class="font-bold italic mb-1 text-blue-500">P2</div>
            <div class="hp-bar"><div id="p2-hp" class="hp-fill" style="float:right"></div></div>
            <div id="p2-mana" class="mana-fill" style="float:right"></div>
        </div>
    </div>

    <div id="fatality">FATALITY</div>

    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // Nhạc nền và SFX
        function playSfx(f, t, d, v=0.1) {
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
            o.stop(audioCtx.currentTime + d);
        }

        function playBGM() {
            const now = audioCtx.currentTime;
            const seq = [220, 247, 261, 293, 329, 349, 392, 440];
            for(let i=0; i<32; i++) {
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.frequency.setValueAtTime(seq[i%seq.length], now + i*0.25);
                g.gain.setValueAtTime(0.02, now + i*0.25);
                g.gain.exponentialRampToValueAtTime(0.0001, now + i*0.25 + 0.2);
                o.connect(g); g.connect(audioCtx.destination);
                o.start(now + i*0.25); o.stop(now + i*0.25 + 0.2);
            }
        }
        setInterval(playBGM, 8000);

        // Thuộc tính nhân vật
        const CharData = {
            'Ninja': { hp: 100, spd: 10, dmg: 1.0, jump: 22, color: '#0cf' },
            'Đại Ca': { hp: 150, spd: 5, dmg: 1.8, jump: 16, color: '#f00' },
            'Vovinam': { hp: 120, spd: 7, dmg: 1.2, jump: 19, color: '#0f0' }
        };

        let p1, p2, keys = {}, isRunning = false;

        class Fighter {
            constructor(x, id, charType) {
                const data = CharData[charType];
                this.id = id; this.x = x; this.y = 0; this.w = 80; this.h = 160;
                this.type = charType; this.hp = data.hp; this.maxHp = data.hp;
                this.spd = data.spd; this.dmg = data.dmg; this.jump = data.jump;
                this.color = data.color; this.vx = 0; this.vy = 0; this.mana = 0;
                this.isJumping = false; this.isBlocking = false; this.atk = 0;
                this.dir = id === 1 ? 1 : -1;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x + this.w/2, this.y + this.h/2);
                if(this.dir === -1) ctx.scale(-1, 1);
                
                // Vẽ người
                ctx.fillStyle = this.isBlocking ? '#777' : this.color;
                ctx.shadowBlur = 20; ctx.shadowColor = this.color;
                ctx.fillRect(-this.w/2, -this.h/2, this.w, this.h);
                
                // Hiệu ứng đòn đánh
                if(this.atk > 0) {
                    ctx.fillStyle = "#fff";
                    ctx.fillRect(40, -10, 70, 20);
                    this.atk--;
                }
                ctx.restore();
            }

            update() {
                this.x += this.vx; this.y += this.vy;
                if(this.y + this.h < canvas.height - 50) this.vy += 1;
                else { this.y = canvas.height - 50 - this.h; this.vy = 0; this.isJumping = false; }
                this.mana = Math.min(100, this.mana + 0.2);
                if(this.x < 0) this.x = 0; if(this.x > canvas.width-this.w) this.x = canvas.width-this.w;
            }

            takeDamage(amt) {
                if(this.isBlocking) amt *= 0.2;
                this.hp -= amt;
                playSfx(150, 'sine', 0.2, 0.3);
                if(this.hp <= 0) finishGame();
            }
        }

        function selectChar(p, type) { playSfx(440, 'square', 0.1); /* Logic đơn giản cho P1, P2 mặc định ngẫu nhiên */ }

        function startGame() {
            isRunning = true;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            p1 = new Fighter(200, 1, 'Ninja');
            p2 = new Fighter(800, 2, 'Đại Ca');
            playBGM();
        }

        function finishGame() {
            isRunning = false;
            document.getElementById('fatality').style.display = 'flex';
            playSfx(50, 'square', 1.5, 0.5);
            setTimeout(() => {
                document.getElementById('fatality').style.display = 'none';
                document.getElementById('lobby').style.display = 'flex';
                document.getElementById('game-ui').style.display = 'none';
            }, 3000);
        }

        window.onkeydown = e => { 
            keys[e.code] = true;
            if(e.code === 'KeyF' && isRunning) { p1.atk = 10; checkHit(p1, p2); }
            if(e.code === 'KeyK' && isRunning) { p2.atk = 10; checkHit(p2, p1); }
        };
        window.onkeyup = e => keys[e.code] = false;

        function checkHit(attacker, defender) {
            let dist = Math.abs(attacker.x - defender.x);
            if(dist < 150) defender.takeDamage(10 * attacker.dmg);
        }

        function loop() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            if(!isRunning) return requestAnimationFrame(loop);

            // Xử lý Input
            p1.vx = 0; p1.isBlocking = false;
            if(keys.KeyA) p1.vx = -p1.spd;
            if(keys.KeyD) p1.vx = p1.spd;
            if(keys.KeyW && !p1.isJumping) { p1.vy = -p1.jump; p1.isJumping = true; }
            if(keys.KeyS) p1.isBlocking = true;

            p2.vx = 0; p2.isBlocking = false;
            if(keys.ArrowLeft) p2.vx = -p2.spd;
            if(keys.ArrowRight) p2.vx = p2.spd;
            if(keys.ArrowUp && !p2.isJumping) { p2.vy = -p2.jump; p2.isJumping = true; }
            if(keys.ArrowDown) p2.isBlocking = true;

            p1.update(); p2.update();
            
            // Vẽ cảnh vật
            ctx.fillStyle = '#111'; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = '#333'; ctx.fillRect(0, canvas.height-50, canvas.width, 50);

            p1.draw(); p2.draw();

            // Cập nhật HUD
            document.getElementById('p1-hp').style.width = (p1.hp/p1.maxHp*100) + '%';
            document.getElementById('p2-hp').style.width = (p2.hp/p2.maxHp*100) + '%';
            document.getElementById('p1-mana').style.width = p1.mana + '%';
            document.getElementById('p2-mana').style.width = p2.mana + '%';

            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>
</html>
